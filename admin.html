<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DF Plus Admin CSV</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f1f5f9;padding:20px}
.card{background:#fff;padding:20px;border-radius:14px;max-width:500px;margin:40px auto}
input,select,button{padding:12px;margin:8px 0;width:100%}
button{border:none;border-radius:10px;cursor:pointer}
.ok{background:#22c55e;color:#fff}
.warn{background:#f59e0b;color:#fff}
.bad{background:#ef4444;color:#fff}
.dark{background:#0f172a;color:#fff}
.hidden{display:none}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #e5e7eb;font-size:14px}
.actions button{margin-right:4px;width:auto;padding:6px 10px}
</style>
</head>
<body>

<div id="lbox" class="card">
<h2>üîê Admin Login</h2>
<input id="u" placeholder="Username">
<input id="p" type="password" placeholder="Password">
<button class="ok" onclick="auth()">Login</button>
<p id="e" style="color:red"></p>
</div>

<div id="abox" class="hidden">
<button class="dark" onclick="out()">Logout</button>

<div class="card">
<h3 id="formTitle">Add / Edit Product</h3>
<input id="n" placeholder="Product Name">
<select id="c">
<option value="computer">Computer</option>
<option value="phone">Phone</option>
</select>
<input id="b" placeholder="Brand">
<input id="pr" type="number" placeholder="Price">
<input id="d" type="number" placeholder="Discount">
<input id="i" placeholder="Image URL">

<button id="saveBtn" class="ok" onclick="add()">Save Product</button>
<button id="cancelBtn" class="warn hidden" onclick="cancelEdit()">Cancel Edit</button>
<button class="dark" onclick="downloadCSV()">Download CSV</button>
<input type="file" id="uploadCSV" style="margin-top:8px" onchange="loadCSV(event)">
</div>

<div class="card">
<h3>Products</h3>
<table>
<thead>
<tr>
<th>ID</th><th>Name</th><th>‚Ç¶</th><th>Actions</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>
</div>

<script>
/* ===== LOGIN CONFIG ===== */
const _U="admin"; // username
const _H="0a3d77a4e1f04a7d5b2c12b22f8d9c021b49c53f7dba1d3c1b07f3e1f34f4b0e"; // SHA-256 for Admin123!

async function _h(t){
 const b=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t));
 return [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("");
}

async function auth(){
 if(u.value!==_U) return e.innerText="Invalid login";
 if(await _h(p.value)===_H){ show(); loadDefaultCSV(); } 
 else e.innerText="Invalid login";
}

function out(){location.reload();}
function show(){lbox.classList.add("hidden");abox.classList.remove("hidden");}

/* ===== PRODUCT DATA ===== */
let P=[]; 
let editIndex=null;

/* ===== LOAD DEFAULT CSV (if exists) ===== */
function loadDefaultCSV(){
 fetch("products.csv")
 .then(r=>r.text())
 .then(data=>parseCSV(data))
 .catch(err=>{
   console.warn("products.csv not found. Starting empty.");
   P=[]; draw();
 });
}

/* ===== CSV PARSER ===== */
function parseCSV(data){
 const rows = data.trim().split("\n").slice(1);
 P = rows.map((r,i)=>{
   const [id,name,category,brand,price,discount,image] = r.split(",");
   return {id,name,category,brand,price:Number(price),discount:Number(discount),image};
 });
 draw();
}

/* ===== DRAW TABLE ===== */
function draw(){
 list.innerHTML="";
 if(!P.length){list.innerHTML="<tr><td colspan='4'>No products yet</td></tr>"; return;}
 P.forEach((x,i)=>{
  list.innerHTML+=`
  <tr>
   <td>${x.id}</td>
   <td>${x.name}</td>
   <td>${x.discount||x.price}</td>
   <td class="actions">
    <button class="warn" onclick="edit(${i})">Edit</button>
    <button class="bad" onclick="del(${i})">Delete</button>
   </td>
  </tr>`;
 });
}

/* ===== CRUD FUNCTIONS ===== */
function add(){
 if(!n.value||!pr.value) return alert("Missing fields");
 if(editIndex===null){
   const id = P.length ? Math.max(...P.map(p=>Number(p.id)))+1 : 1;
   P.push({id,name:n.value,category:c.value,brand:b.value,price:+pr.value,discount:+d.value||0,image:i.value});
 } else {
   P[editIndex]={...P[editIndex],name:n.value,category:c.value,brand:b.value,price:+pr.value,discount:+d.value||0,image:i.value};
 }
 draw(); resetForm();
}

function edit(i){
 const x=P[i]; n.value=x.name;c.value=x.category;b.value=x.brand;pr.value=x.price;d.value=x.discount;i.value=x.image;
 editIndex=i;formTitle.innerText="Edit Product";saveBtn.innerText="Update";cancelBtn.classList.remove("hidden");
}

function cancelEdit(){resetForm();}
function resetForm(){ n.value=b.value=pr.value=d.value=i.value=""; c.value="computer"; editIndex=null;
formTitle.innerText="Add Product"; saveBtn.innerText="Save Product"; cancelBtn.classList.add("hidden");}

function del(i){if(confirm("Delete product?")){P.splice(i,1);draw();}}

/* ===== CSV EXPORT ===== */
function downloadCSV(){
 if(!P.length){alert("No products to export"); return;}
 const header="id,name,category,brand,price,discount,image\n";
 const rows = P.map(p=>`${p.id},${p.name},${p.category},${p.brand},${p.price},${p.discount},${p.image}`).join("\n");
 const csvContent = header + rows;
 const blob = new Blob([csvContent], {type:"text/csv"});
 const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download="products.csv"; a.click();
}

/* ===== CSV UPLOAD ===== */
function loadCSV(event){
 const file = event.target.files[0];
 if(!file) return;
 const reader = new FileReader();
 reader.onload = function(e){ parseCSV(e.target.result); }
 reader.readAsText(file);
}
</script>

</body>
</html>
